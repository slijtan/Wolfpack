<% content_for :head do %>
<style>
	#itinerary-wrapper { position: relative; }
	#day-timeline,
	#block-timeline,
	.user-itinerary { height: 27px; position: relative; }
	#block-timeline { font-size: 8pt; }
	.user-itinerary.odd { background-color: #EAEAEA; }
	.s-offset { width: 150px; position: absolute; left: 10px; top: 4px; }
	.timeline-header { height: 80%; }
	.day-header { font-size: 8pt; }
	.day-header,
	.timeline-header,
	.user-timeline { left: 150px; position: absolute; right: 2px; }
	.day-segment { position: absolute; background-color: gray; text-align: center; }
	.vbars { position: absolute; top: -9px; bottom: 0; border-right: 1px solid; z-index: 1; }
	.timeline-segment { position: absolute; margin-left: -12px; top: 4px; }
	.flight-info { position: absolute; top: 4px; display: inline; -moz-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; }
	.d-time { margin-right: 5px; }
	.a-time { margin-left: 5px; }
	.f-time { display: none; position: absolute; font-size: 8pt; top: 7px; padding: 0 4px; background-color: wheat; }
</style>
<% end %>
<% total_segments = num_trip_time_blocks(@trip) %>
<div id="itinerary-wrapper">
	<div id="day-timeline">
		<div class="s-offset"></div>
		<div class="day-header">
			<% (0..@trip.duration_in_days-1).each do |day_index| %>
			<div class="day-segment" style="left:<%= 100 * day_index / (@trip.duration_in_days) %>%; width: <%= 100 / (@trip.duration_in_days) %>%">
				<%= (@trip.start_date + day_index.day).strftime("%a %m/%d") %>
			</div>
			<% end %>
		</div>
	</div>
	<div id="vertical-timeline">
		<div class="s-offset"></div>
		<div class="timeline-header">
			<% (0..total_segments).each_with_index do |time_segment, index| %>
				<div class="vbars" style="left:<%= (100 * index) / total_segments %>%;">
				</div>
			<% end %>
		</div>
	</div>
	<div id="block-timeline">
		<% @destinations.each do |dest| %>
		<div class="s-offset"><%= dest.carrier_flight.from.full_name %></div>
		<div class="timeline-header">
			<% (0..total_segments).each_with_index do |time_segment, index| %>
				<div class="timeline-segment" style="left:<%= (100 * index) / total_segments %>%;">
					<%= convert_index_to_time(@trip, index) %>
				</div>
			<% end %>
		</div>
		<% end %>
	</div>
	<% @trip.users.each do |user| %>
		<div class="user-itinerary <%= cycle('odd', 'even') %>">
			<div class="s-offset">
				<%= user.full_name %>
			</div>
			<div class="user-timeline">
				<% user.flights.each do |flight| %>
					<% f_left = 100 * flight.minutes_since_trip_start / @trip.duration_in_minutes %>
					<% f_width = 100 * flight.flight_duration / @trip.duration_in_minutes %>
					<span class="d-time f-time" style="right: <%= 100 - f_left %>%"><%= flight.departure_time %></span>
					<div class="flight-info" style="left:<%= f_left %>%; width:<%= f_width %>%; background-color: red;">
						<%= flight.flight_duration %>
					</div>
					<span class="a-time f-time" style="left: <%= f_left + f_width %>%"><%= flight.arrival_time %></span>
				<% end %>
			</div>
		</div>
	<% end %>
</div>

<% content_for :script do %>
<script>
	$('.flight-info').mouseover(function() {
		$(this).prev().show();
		$(this).next().show();
	}).mouseout(function() {
		$(this).prev().hide();
		$(this).next().hide();
	});
</script>
<% end %>